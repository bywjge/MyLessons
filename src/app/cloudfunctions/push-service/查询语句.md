## My Lesson 推送服务 数据库查询语句
Last Edit: Marc. 22, 2022.

---

### 获取某日期某节课有课的用户以及课程数据
```js
db.collection('lessons')
  .aggregate()
  .unwind('$lessons')
  .match({
    '_id': _.gt(''), // 这里填入上次查询后最后一个结果的id
    'lessons.日期': _.eq('2022-03-22'),
    // 确保这里是两位数字的字符串
    'lessons.节次': _.elemMatch(_.eq("05"))
  })
  .project({
    lesson: '$lessons',
    _openid: true
  })
  .limit(100)
  .end()
```


### 通过openid拿到用户的所有信息
```js
db.collection('accounts')
  .aggregate()
  .match({
    _openid: _.eq('owOJ55OP2qItDaB6Z3Vl8bot3WrA')
  })
  .lookup({
    from: 'info',
    localField: 'username',
    foreignField: 'username',
    as: 'info'
  })
  .project({
    username: true,
    info: '$info.info'
  })
  .end()
```

