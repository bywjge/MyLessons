<view class="container">
  <navigation enableMenu="{{false}}" title="ç©ºæ•™å®¤æŸ¥è¯¢" />
  <view class="content">
    <view class="top-bar">
      <view class="time">
        <view class="title">{{timeList[lessonIndex - 1]['text']}}</view>
        <view class="subtitle">{{timeList[lessonIndex - 1]['time']}}</view>
      </view>

      <view class="operations">
        <!-- <view bindtap="switchToListView" class="icon list" hover-class="button-tap" /> -->
        <picker 
          mode="selector" 
          range="{{pickerArray}}"
          range-key="text"
          value="{{selectedDate}}" 
          bindchange="selectDate"
          header-text="é€‰æ‹©æœªæ¥ä¸¤å‘¨å†…çš„ä¸€å¤©"
        >
          <view class="calendar" hover-class="button-tap">
            {{pickerArray[selectedDateIndex]['text']}}
          </view>
        </picker>
        <view bindtap="reload" class="icon reload" hover-class="button-tap" />
      </view>

      <view class="filter button {{show === 'occupy'? 'undone': 'done'}}" hover-class="filter-button-tap" bindtap="changeShowMode" data-name="pass" data-disabled="{{disableButton.pass}}">
        <view>{{show === 'occupy'? 'æ­£åœ¨ä¸Šè¯¾': 'æœªåœ¨ä¸Šè¯¾'}}</view>
        <view class="number">{{show === 'occupy'? onGoingCount: 90 - onGoingCount}}</view>
      </view>
    </view>

    <!-- ä¸‹æ–¹å¯æ‹–åŠ¨åŒºåŸŸ -->
    <movable-area class="move-area" >
      <movable-view 
        x="{{x}}" 
        y="{{y}}" 
        direction="all" 
        out-of-bounds="{{true}}" 
        scale="{{true}}" 
        scale-max="{{1.5}}"
        style="width: 2000px; height: 2000px"
      >
        <view class="building-wrapper show-{{show}}">
          <!-- é©¬å…°èŠ³ -->
          <view class="building">
            <view class="row" wx:for="{{5}}" wx:for-item="floor" wx:key="floor">
              <view class="indexer">{{floor + 1}}F</view>
              <view class="square {{!buildings['é©¬å…°èŠ³'][floor][index]? 'free': 'occupied'}}" wx:for="{{4}}" wx:for-item="index" wx:key="index"/>
            </view>
            <view class="row top-indexer">
              <view class="indexer" wx:for="{{4}}" wx:for-item="index" wx:key="index">0{{index+1}}</view>
            </view>
            <view class="name">é©¬å…°èŠ³æ•™å­¦æ¥¼</view>
          </view>

          <!-- åŒ—ä¸»æ¥¼ -->
          <view class="building">
            <view class="row {{floor===0?'hidden':''}}" wx:for="{{11}}" wx:for-item="floor" wx:key="floor">
              <view class="indexer">{{floor + 1}}F</view>
              <view class="square {{!buildings['åŒ—ä¸»æ¥¼'][floor][index]? 'free': 'occupied'}}" wx:for="{{5}}" wx:for-item="index" wx:key="index"/>
            </view>
            <view class="row top-indexer">
              <view class="indexer" wx:for="{{5}}" wx:for-item="index" wx:key="index">0{{index+1}}</view>
            </view>
            <view class="name">åŒ—ä¸»æ¥¼</view>
          </view>

          <!-- é»„æµ©å· -->
          <view class="building">
            <view class="row" wx:for="{{5}}" wx:for-item="floor" wx:key="floor">
              <view class="indexer">{{floor + 1}}F</view>
              <view class="square {{!buildings['é»„æµ©å·'][floor][index]? 'free': 'occupied'}}" wx:for="{{4}}" wx:for-item="index" wx:key="index" />
            </view>
            <view class="row top-indexer">
              <view class="indexer" wx:for="{{4}}" wx:for-item="index" wx:key="index">0{{index+1}}</view>
            </view>
            <view class="name">é»„æµ©å·æ•™å­¦æ¥¼</view>
          </view>

          <!-- å—ä¸»æ¥¼ -->
          <view class="building south">
            <view class="number-wrapper"> 
              <view class="row" wx:for="{{5}}" wx:for-item="floor" wx:key="floor" wx:if="{{floor !== 0}}">
                <view class="indexer">{{floor + 1}}F</view>
                <view style="display: flex; flex-wrap: wrap; justify-content: space-between;">
                  <view class="text" wx:for="{{numbers['å—ä¸»æ¥¼'][floor]}}" wx:for-item="e" wx:key="e" wx:if="{{show === 'occupy' && e !== null}}">{{e}} </view>
                  <view class="text" wx:for="{{numbers['å—ä¸»æ¥¼ç©ºæ•™å®¤'][floor]}}" wx:for-item="e" wx:key="e" wx:if="{{show !== 'occupy' && e !== null}}">{{e}}</view>
                </view>
              </view>
            </view>
            <view style="font-size: 200rpx">ğŸ˜…</view>
            <view class="subtitle">ä»¥ä¸‹æ˜¯{{show === 'occupy'? 'æ­£åœ¨ä¸Šè¯¾': 'æœªåœ¨ä¸Šè¯¾'}}çš„æ•™å®¤åˆ—è¡¨</view>
            <view class="title">æˆ‘ç”»ä¸å‡ºæ¥</view>
            <view class="name">å—ä¸»æ¥¼</view>
          </view>
        </view>
      </movable-view>
    </movable-area>

    <view class="bottom-operations">
      <view class="change-index reverse {{lessonIndex === 1? 'disable': ''}}" style="margin-right: 40rpx" hover-class="change-index-tap" bindtap="handlePrevLessons" />
      <view class="change-index {{lessonIndex === 7? 'disable': ''}}" hover-class="change-index-tap" bindtap="handleNextLessons" />
    </view>
  </view>
</view>